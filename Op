맞아. 내가 “어디서 읽어서 어떤 변수에 넣는지” 그 연결 코드를 안 줬네.

지금 네 상황에서 “추가해야 하는 부분만” 딱 주면, 이렇게 하면 끝이야.


아래는 MainForm에 추가할 최소 코드 3덩어리야.



1) MainForm 필드 2개 추가 (팝업에 넘길 값 저장용)


MainForm 클래스 필드 쪽에 추가:


private string? _loginIdFromJson;
private string? _loginPwFromJson;




2) device_map.json에서 credentials 읽는 함수 추가 (MainForm 안에)


private (string? id, string? pw) LoadCredentialsFromMap(string mapPath)
{
    try
    {
        using var doc = JsonDocument.Parse(File.ReadAllText(mapPath));
        if (!doc.RootElement.TryGetProperty("credentials", out var cred))
            return (null, null);

        string? id = cred.TryGetProperty("id", out var pid) ? pid.GetString() : null;
        string? pw = cred.TryGetProperty("pw", out var ppw) ? ppw.GetString() : null;

        return (id, pw);
    }
    catch
    {
        return (null, null);
    }
}





전제: device_map.json 최상위에 아래처럼 넣어둬야 함

"credentials": { "id": "...", "pw": "..." }





3) ReloadMap()에서 “기존 로드 + credentials 로드” 연결 (여기가 너가 말한 ‘json 가져올 때 여기에 넣어야’ 부분)


너 ReloadMap() 맨 마지막( _index = DeviceIndex.Load(MapPath); 바로 아래) 에 이 3줄만 추가:


var (id, pw) = LoadCredentialsFromMap(MapPath);
_loginIdFromJson = id;
_loginPwFromJson = pw;



최종적으로 ReloadMap 일부가 이렇게 되는 느낌:


_index = DeviceIndex.Load(MapPath);

var (id, pw) = LoadCredentialsFromMap(MapPath);
_loginIdFromJson = id;
_loginPwFromJson = pw;




4) (중요) 팝업 만들 때 SetAutoCredentials 호출 추가


너 CoreWebView2_NewWindowRequested 안에서 popup 만든 직후에 딱 이거:


if (!string.IsNullOrWhiteSpace(_loginIdFromJson) && !string.IsNullOrWhiteSpace(_loginPwFromJson))
    popup.SetAutoCredentials(_loginIdFromJson!, _loginPwFromJson!);




정리




“json 가져올 때 값을 여기에 넣어야” = ReloadMap()에서 _loginIdFromJson/_loginPwFromJson에 넣는 게 제일 자연스러움 (map 파일을 여기서 읽으니까)


에러났던 loginIdFromJson 같은 건 변수 자체가 없어서 나는 거고, 위처럼 필드로 만들고 ReloadMap에서 채우면 해결





원하면 내가 네 device_map.json 기본 생성 코드도 살짝 수정해줄게.

지금 너 코드가 파일 없으면 자동 생성하잖아? 거기에 credentials 기본 템플릿까지 같이 넣게 하면 “항상 키가 존재”해서 더 편해짐.

